报表可配置实现方案

目录

1.应用场景分析
Item 说明 备注
背景分析
在大多数后台管理项目中, 页面的组成结构大都是以表单和表格为基础搭建而成, 这些⻚⾯:

功能相似度⾼(表单用来过滤搜索条件, 表格用来展示查询结果和导出)，重复开发⼯作较多;
而且多人开发模式下, 代码风格各异, 不利于维护
每次产品要求开发新功能页面或者是增删减字段时, 需要重新开发和部署上线, 每次都需要依赖发版流程, 效率不高...

需求分析
需求功能
将上述功能简单, 逻辑重复的管理页面通过 配置器 来生成, 只需要在配置器工具上配置好相关需要展示的字段就能生成一个页面无缝插入到项目中

需求对象
运营产品, 通过可视化界面来配置

研发人员, 通过脚本工具一键生成组件代码

可行性分析
目前的页面配置化只是将高频的业务需求简化成了一个固定流程，所有这里我们需要有所取舍, 在支持业务快速的实现的同时需要放弃一定的定制化需求.

以 wms 管理系统为例, 我们可以先把页面分为两种:

1.简单页面:  只包括查询展示等简单功能
     2.复杂页面:  除了上述功能, 表格还插入各类自定义操作的功能, 比如弹窗确认, 弹窗表格, 打印等个性化操作...

1.所有页面全部通过配置器来生成,  配置得支持定制化较高场景, 目前比较流行的技术是开发可视化组件编辑器, 直接在编辑器上实现, 支持页面拼装和组合, 这个开发的成本代价很高, 人力要求多...

2.简单页面配置化 + 复杂页面自行开发的方式,  也就是半自动化式的开发, 一部分简单需求通过配置器生成, 另一部分手动开发, 最后页面渲染时注入我们的所有配置项, 这样虽说开发成本稍微高一点, 但是基本上可以满足所有需求, 投入人力较少. 后期还可以迭代支持复杂点的功能

技术分析

如何做一个页面配置化平台?

1.页面



每个页面都是由组件化的元素构成的, 组件又可以拆分成表单组件和表格组件; 表单组件都是表单元素组成, 表格组件都是由列元素组成...  这里需要丰富的组件库功能来支持我们的页面物料拼装

2.配置

如何去配置一个上述页面的信息:  config.json 或者 config.js 组装所有页面信息

通过 pageEngine 实现 配置项 =》 vnode 节点 =》 vue/react =》 页面

难点分析

1.如何生成配置文件? 2.配置文件怎么转化为 vnode 节点? 3.页面数据通信如何解决?

4.多框架支持等?

方案概述

1.配置文件

开发一个配置前台系统, 给运营提供一个配置界面, 来完成配置页面 Json 文件生成; 另外提供一个标准的 Json 模版, 可以让开发人员更改一些属性后快速生成页面 json

json 文件的存储:  通过 MongoDB 来实现存储数据

2.页面渲染
初始化过程中, 我们通过接口拉取页面 json 数据集, 通过 page engine 生成页面组件, 构成动态路由, 与静态路由进行 merge, 最后一起注入到页面中

技术实现
配置平台:

前端配置界面
JSON 配置生成方式 1.通过表单收集组成 json 数据 2.在线编写一份 json 格式文档, 导入或者粘贴过来
JSON 页面管理, 增删改查, 预览等功能
后端接口
JSON 配置增删改查

功能点 &

技术选型

前端:  常规的管理界面
            页面新增

页面修改

页面查询+删除

页面预览

选型: vite + vue3 + antd-next + ts

后端:

- 增删改查接口
          addConfig

deleteConfig

updateConfig

queryConfig

- 后端接口适配器

对 server 的接口进行一层转化, 适配 server 返回数据不规范的问题

选型: egg + mongodb + ts

2.功能设计
前端界面暂定功能设计
       - 配置管理
       - 配置预览

PageEngine 实现
       - 本质可以理解成为 一个大型的业务组件

- 目前先沿用 react 版的 hetu-component 内部组件来支撑页面渲染, 改动的工作量还是比较大的...
       - 后期可以慢慢修改, 迁移到 vue 技术栈

后端功能设计
API

1.新增配置页面

Url:  /addConfig
Method: POST
Params:

参数字段

类型

是否必填

含义

pageUrl string 是 页面访问地址, 遵循一定规则

{
returnCode: 0,
returnMsg: "succ",
returnUserMsg: "成功",
data: {
// 其他信息...
form: {},
table: {}
}
}

2.修改配置

Url:  /updateConfig
          其它 同上

3.查询配置

Url:  /queryConfig
Method: GET
Params:

参数字段

类型

是否必填

含义

pageSize int 否 分页量
pageNo int 否 页码

{
returnCode: 0,
returnMsg: "succ",
returnUserMsg: "成功",
data: {
list: [
{
form: {},
table: {}
},
....
],
totalCount: 99,
pageSize: 10,
pageNo: 1
}
}

4.删除配置

Url:  /deleteConfig
          其它 同 新增

3.开发进度
功能模块 完成情况 时间节点 备注说明
前端平台配置页面

后端接口 API

4.文档设计
https://wiki.megvii-inc.com/pages/viewpage.action?pageId=251389933
